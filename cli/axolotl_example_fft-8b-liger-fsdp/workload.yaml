experiment_name: axolotl-llama-8b

environment:
  dependencies: requirements.yaml
  env_variables_secrets:   
    HF_TOKEN: "sgc-nightly-notebook/hf_token" # change this to your own hugging face token
compute:
  gpus: 16
  gpu_type: h100

max_retries: 0
workspace:
  host: https://e2-dogfood.staging.cloud.databricks.com/

command: |-
  # path to the accelerate config
  ACCEL_CONFIG="/Workspace/Shared/default_accelerate_config.yaml"
  # path to the axolotl config
  TRAIN_CONFIG="/Workspace/Shared/axolotl-sgc/examples/llama-3/fft-8b-liger-fsdp.yaml"

  accelerate launch \
    --config_file "$ACCEL_CONFIG" \
    --machine_rank=$NODE_RANK \
    --num_machines 2 \
    --num_processes $WORLD_SIZE \
    --main_process_ip $MASTER_ADDR \
    --main_process_port $MASTER_PORT \
    -m axolotl.cli.train "$TRAIN_CONFIG"
